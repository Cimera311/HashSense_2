<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HashFarm - Scripts & Tools (clean)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style>
    /* Minimal styles for the cleaned-up script UI */
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    .script-textarea { background: linear-gradient(135deg,#0f172a,#111827); color:#e6eef8; border-radius:8px; padding:1rem; border:1px solid #374151; }
    .copy-btn { background:linear-gradient(90deg,#7c3aed,#a855f7); color:white; padding:.5rem .75rem; border-radius:.5rem; display:inline-flex; gap:.5rem; align-items:center; }
    .copy-success { background: rgba(16,185,129,0.08); color:#86efac; padding:.5rem; border-radius:.5rem; border:1px solid rgba(16,185,129,0.18); }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
  <header class="bg-gray-800 p-4">
    <div class="max-w-5xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button id="sidebarToggle" class="p-2 rounded bg-purple-600" aria-label="Toggle sidebar"><span class="material-icons">menu</span></button>
        <h1 class="text-xl font-bold">HashFarm — Scripts & Tools</h1>
      </div>
      <div class="flex gap-2">
        <button id="deBtn" class="px-3 py-1 rounded bg-purple-600">DE</button>
        <button id="enBtn" class="px-3 py-1 rounded bg-gray-700">EN</button>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-6">
    <section id="deSection">
      <h2 class="text-2xl font-semibold mb-2">Deutsch — GoMining Transaktions-Export Scripts</h2>
      
      <div class="bg-blue-900/50 border border-blue-500/30 rounded-lg p-4 mb-6">
        <div class="flex items-start gap-3">
          <span class="material-icons text-blue-400 mt-1">info</span>
          <div>
            <h3 class="text-lg font-semibold text-blue-300 mb-2">Über dieses Script</h3>
            <p class="text-gray-300 mb-3">
              Dieses JavaScript-Script hilft Ihnen die Transaktionen der Gomining Plattform zu exportieren. 
            </p>
          </div>
        </div>
      </div>

      <div class="bg-gray-800 rounded-lg p-4 mb-6">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-3">
            <span class="material-icons text-yellow-400">javascript</span>
            <div>
              <div class="font-mono">gomining-export.js</div>
              <div class="text-xs text-gray-400">
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <button class="copy-btn" onclick="copyToClipboard('deScriptContent', event)"><span class="material-icons">content_copy</span><span>Kopieren</span></button>
          </div>
        </div>

        <textarea id="deScriptContent" class="script-textarea w-full h-80 font-mono" placeholder="Hier Script einfügen (DE). Du kannst später in die Console einfügen.">
globalThis.cancelExport = false;
      globalThis.dateFormat = 'us'; // Default

      function normalizeDate(dateStr, format) {
        if (format === 'eu') {
          if (dateStr.includes('/')) {
            const [d, m, y] = dateStr.split('/');
            return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
          } else if (dateStr.includes('.')) {
            const [d, m, y] = dateStr.split('.');
            return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
          }
        } else {
          if (dateStr.includes('/')) {
            const [m, d, y] = dateStr.split('/');
            return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
          }
        }
        return dateStr;
      }

      (async function () {
        window.cancelGoMiningExport = function () {
          cancelExport = true;
          console.log("Export manually aborted! 🚫");
        };

        function getFirstRowKey() {
          const firstRow = document.querySelector('tbody tr');
          const rawDate = firstRow?.querySelector('datetime-display span.text-muted')?.innerText.trim() || '';
          const date = normalizeDate(rawDate, dateFormat);
          const time = firstRow?.querySelector('datetime-display span.fw-medium')?.innerText.trim() || '';
          const value = firstRow?.querySelector('[data-qa-column="value"] span.hidden-empty.ms-1 > span')?.innerText.trim() || '';
          const pageSpan = document.querySelector('div.w-100.d-flex.align-items-center.justify-content-center span.mx-2.p-2');
          const pageNumber = pageSpan?.innerText.trim() || '';
          return `${pageNumber}_${date}_${time}_${value}`;
        }

        function extractRows() {
          const rows = document.querySelectorAll('tbody tr');
          const extracted = [];

          rows.forEach(row => {
            const time = row.querySelector('datetime-display span.fw-medium')?.innerText.trim() || '';
            const rawDate = row.querySelector('datetime-display span.text-muted')?.innerText.trim() || '';
            const date = normalizeDate(rawDate, dateFormat);
            const type = row.querySelector('[data-qa-column="type"]')?.innerText.trim() || '';

            const valueElement = row.querySelector('[data-qa-column="value"]');
            let valueText = valueElement?.querySelector('span.hidden-empty.ms-1 > span')?.innerText.trim() || '';
            let isNegative = valueText.startsWith('-');
            valueText = valueText.replace('.', '#').replace(/[.,]/g, '').replace('#', ',');
            valueText = valueText.replace('+', '').replace('-', '');
            if (isNegative) {
              valueText = '-' + valueText;
            }

            let currency = '';
            if (valueElement?.querySelector('icon-gmt')) {
              currency = 'GMT';
            } else if (valueElement?.querySelector('icon-bitcoin-circle')) {
              currency = 'BTC';
            }

            const status = row.querySelector('[data-qa-column="status"]')?.innerText.trim() || '';

            extracted.push({ date, time, type, value: valueText, currency, status });
          });

          return extracted;
        }

        function exportToCSV(data) {
          let csv = "Date-DayMonthYear;Date-Time;Type;Value;Currency;Status\n";
          data.forEach(item => {
            csv += `"${item.date}";"${item.time}";"${item.type}";"${item.value}";"${item.currency}";"${item.status}"\n`;
          });

          let filename = "gomining_transactions.csv";
          const dateRangeElement = document.querySelector('.catalog-index_block-filter-item');
          if (dateRangeElement) {
            const dateText = dateRangeElement.innerText
              .trim()
              .replace(/\s+/g, '_')
              .replace(/[,]/g, '')
              .replace(/[^\w\-]/g, '');
            filename = `gomining_${dateText}.csv`;
          }

          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.setAttribute("href", url);
          link.setAttribute("download", filename);
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        async function goMiningAutoExport() {
          let allData = [];
          let previousKey = getFirstRowKey();
          let pageCounter = 1;

          while (true) {
            if (cancelExport) {
              console.log("Export manually aborted! 🚫");
              break;
            }

            console.log(`Page done ${pageCounter}...`);
            allData = allData.concat(extractRows());

            let icon = document.querySelector('icon-arrow-short[direction="right"]');
            let nextButton = icon?.closest('button');

            if (!nextButton || nextButton.disabled) {
              console.log("Button not ready yet. Waiting 5 seconds and trying again...");
              await new Promise(r => setTimeout(r, 5000));
              icon = document.querySelector('icon-arrow-short[direction="right"]');
              nextButton = icon?.closest('button');

              if (!nextButton || nextButton.disabled) {
                console.log("Button still not ready. Waiting again...");
                await new Promise(r => setTimeout(r, 5000));
                icon = document.querySelector('icon-arrow-short[direction="right"]');
                nextButton = icon?.closest('button');

                if (!nextButton || nextButton.disabled) {
                  console.log("Still no button. Exporting current data and stopping.");
                  break;
                }
              }
            }

            nextButton.click();
            if (pageCounter % 10 === 0) {
              console.log(`Short break after page ${pageCounter}...`);
              await new Promise(r => setTimeout(r, 5000));
            } else {
              await new Promise(r => setTimeout(r, 350));
            }

            let newKey = getFirstRowKey();
            if (newKey === previousKey) {
              console.log("Page appears unchanged. Waiting 5 seconds and checking again...");
              await new Promise(r => setTimeout(r, 5000));
              newKey = getFirstRowKey();

              if (newKey === previousKey) {
                console.log("Page still unchanged. Saving final page...");
                allData = allData.concat(extractRows());
                break;
              }
            }

            previousKey = newKey;
            pageCounter++;
          }

          if (allData.length > 0) {
            console.log(`Exporting ${allData.length} transactions...`);
            exportToCSV(allData);
          } else {
            console.log("No data collected to export.");
          }
        }

        await goMiningAutoExport();
      })();
        </textarea>

        <div id="copySuccessDE" class="hidden mt-3 copy-success">Script erfolgreich kopiert!</div>
      </div>

      <div class="prose text-gray-300">
        <h3 class="text-xl font-semibold mb-3 text-purple-300">📋 Anleitung</h3>
        <div class="bg-gray-800/50 rounded-lg p-4 space-y-3">
          <div class="flex items-start gap-3">
            <span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">1</span>
            <p>Gehe zur gewünschten Seite bei GoMining (z.B. Transaktionsübersicht, Miner-Dashboard, etc.)</p>
          </div>
          <div class="flex items-start gap-3">
            <span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">2</span>
            <p>Öffne die Browser-Konsole mit <kbd class="bg-gray-700 px-2 py-1 rounded">F12</kbd> und wechsle zum <strong>Console</strong>-Tab</p>
          </div>
          <div class="flex items-start gap-3">
            <span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">3</span>
            <p>Klicke auf <strong>Kopieren</strong></p>
          </div>
          <div class="flex items-start gap-3">
            <span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">4</span>
            <p>Füge das kopierte Script in die Konsole ein und drücke <kbd class="bg-gray-700 px-2 py-1 rounded">Enter</kbd></p>
          </div>
        </div>
        
        <div class="mt-6 bg-yellow-900/30 border border-yellow-500/30 rounded-lg p-4">
          <div class="flex items-start gap-3">
            <span class="material-icons text-yellow-400 mt-1">warning</span>
            <div>
              <h4 class="font-semibold text-yellow-300 mb-2">⚠️ Wichtige Hinweise</h4>
              <ul class="text-sm text-gray-300 space-y-1">
                <li>• Bei Fehlern Browser-Cache leeren (Strg+F5)</li>
                <li>• Funktioniert nur für die Transaktionen in GoMining</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="enSection" style="display:none;">
      <h2 class="text-2xl font-semibold mb-2">English — GoMining Export Scripts</h2>
      
      <div class="bg-blue-900/50 border border-blue-500/30 rounded-lg p-4 mb-6">
        <div class="flex items-start gap-3">
          <span class="material-icons text-blue-400 mt-1">info</span>
          <div>
            <h3 class="text-lg font-semibold text-blue-300 mb-2">About this Script</h3>
            <p class="text-gray-300 mb-3">
              The script can export transactions from the GoMining platform.
            </p>
          </div>
        </div>
      </div>

      <div class="bg-gray-800 rounded-lg p-4 mb-6">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-3">
            <span class="material-icons text-yellow-400">javascript</span>
            <div>
              <div class="font-mono">gomining-export.js</div>
              <div class="text-xs text-gray-400">JavaScript · Paste script here later</div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <button class="copy-btn" onclick="copyToClipboard('enScriptContent', event)"><span class="material-icons">content_copy</span><span>Copy</span></button>
          </div>
        </div>

        <textarea id="enScriptContent" class="script-textarea w-full h-80 font-mono" placeholder="Paste your script here (EN). You can paste it into the console later.">
            globalThis.cancelExport = false;
      globalThis.dateFormat = 'us'; // Default

      function normalizeDate(dateStr, format) {
        if (format === 'eu') {
          if (dateStr.includes('/')) {
            const [d, m, y] = dateStr.split('/');
            return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
          } else if (dateStr.includes('.')) {
            const [d, m, y] = dateStr.split('.');
            return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
          }
        } else {
          if (dateStr.includes('/')) {
            const [m, d, y] = dateStr.split('/');
            return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
          }
        }
        return dateStr;
      }

      (async function () {
        window.cancelGoMiningExport = function () {
          cancelExport = true;
          console.log("Export manually aborted! 🚫");
        };

        function getFirstRowKey() {
          const firstRow = document.querySelector('tbody tr');
          const rawDate = firstRow?.querySelector('datetime-display span.text-muted')?.innerText.trim() || '';
          const date = normalizeDate(rawDate, dateFormat);
          const time = firstRow?.querySelector('datetime-display span.fw-medium')?.innerText.trim() || '';
          const value = firstRow?.querySelector('[data-qa-column="value"] span.hidden-empty.ms-1 > span')?.innerText.trim() || '';
          const pageSpan = document.querySelector('div.w-100.d-flex.align-items-center.justify-content-center span.mx-2.p-2');
          const pageNumber = pageSpan?.innerText.trim() || '';
          return `${pageNumber}_${date}_${time}_${value}`;
        }

        function extractRows() {
          const rows = document.querySelectorAll('tbody tr');
          const extracted = [];

          rows.forEach(row => {
            const time = row.querySelector('datetime-display span.fw-medium')?.innerText.trim() || '';
            const rawDate = row.querySelector('datetime-display span.text-muted')?.innerText.trim() || '';
            const date = normalizeDate(rawDate, dateFormat);
            const type = row.querySelector('[data-qa-column="type"]')?.innerText.trim() || '';

            const valueElement = row.querySelector('[data-qa-column="value"]');
            let valueText = valueElement?.querySelector('span.hidden-empty.ms-1 > span')?.innerText.trim() || '';
            let isNegative = valueText.startsWith('-');
            valueText = valueText.replace('.', '#').replace(/[.,]/g, '').replace('#', ',');
            valueText = valueText.replace('+', '').replace('-', '');
            if (isNegative) {
              valueText = '-' + valueText;
            }

            let currency = '';
            if (valueElement?.querySelector('icon-gmt')) {
              currency = 'GMT';
            } else if (valueElement?.querySelector('icon-bitcoin-circle')) {
              currency = 'BTC';
            }

            const status = row.querySelector('[data-qa-column="status"]')?.innerText.trim() || '';

            extracted.push({ date, time, type, value: valueText, currency, status });
          });

          return extracted;
        }

        function exportToCSV(data) {
          let csv = "Date-DayMonthYear;Date-Time;Type;Value;Currency;Status\n";
          data.forEach(item => {
            csv += `"${item.date}";"${item.time}";"${item.type}";"${item.value}";"${item.currency}";"${item.status}"\n`;
          });

          let filename = "gomining_transactions.csv";
          const dateRangeElement = document.querySelector('.catalog-index_block-filter-item');
          if (dateRangeElement) {
            const dateText = dateRangeElement.innerText
              .trim()
              .replace(/\s+/g, '_')
              .replace(/[,]/g, '')
              .replace(/[^\w\-]/g, '');
            filename = `gomining_${dateText}.csv`;
          }

          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.setAttribute("href", url);
          link.setAttribute("download", filename);
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        async function goMiningAutoExport() {
          let allData = [];
          let previousKey = getFirstRowKey();
          let pageCounter = 1;

          while (true) {
            if (cancelExport) {
              console.log("Export manually aborted! 🚫");
              break;
            }

            console.log(`Page done ${pageCounter}...`);
            allData = allData.concat(extractRows());

            let icon = document.querySelector('icon-arrow-short[direction="right"]');
            let nextButton = icon?.closest('button');

            if (!nextButton || nextButton.disabled) {
              console.log("Button not ready yet. Waiting 5 seconds and trying again...");
              await new Promise(r => setTimeout(r, 5000));
              icon = document.querySelector('icon-arrow-short[direction="right"]');
              nextButton = icon?.closest('button');

              if (!nextButton || nextButton.disabled) {
                console.log("Button still not ready. Waiting again...");
                await new Promise(r => setTimeout(r, 5000));
                icon = document.querySelector('icon-arrow-short[direction="right"]');
                nextButton = icon?.closest('button');

                if (!nextButton || nextButton.disabled) {
                  console.log("Still no button. Exporting current data and stopping.");
                  break;
                }
              }
            }

            nextButton.click();
            if (pageCounter % 10 === 0) {
              console.log(`Short break after page ${pageCounter}...`);
              await new Promise(r => setTimeout(r, 5000));
            } else {
              await new Promise(r => setTimeout(r, 350));
            }

            let newKey = getFirstRowKey();
            if (newKey === previousKey) {
              console.log("Page appears unchanged. Waiting 5 seconds and checking again...");
              await new Promise(r => setTimeout(r, 5000));
              newKey = getFirstRowKey();

              if (newKey === previousKey) {
                console.log("Page still unchanged. Saving final page...");
                allData = allData.concat(extractRows());
                break;
              }
            }

            previousKey = newKey;
            pageCounter++;
          }

          if (allData.length > 0) {
            console.log(`Exporting ${allData.length} transactions...`);
            exportToCSV(allData);
          } else {
            console.log("No data collected to export.");
          }
        }

        await goMiningAutoExport();
      })();
        </textarea>

        <div id="copySuccessEN" class="hidden mt-3 copy-success">Script successfully copied!</div>
      </div>

      <div class="prose text-gray-300">
        <h3 class="text-xl font-semibold mb-3 text-purple-300">📋 Instructions</h3>
        <div class="bg-gray-800/50 rounded-lg p-4 space-y-3">
          <div class="flex items-start gap-3">
            <span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">1</span>
            <p>Navigate to the desired page on GoMining (e.g. transactions overview, miner dashboard, etc.)</p>
          </div>
          <div class="flex items-start gap-3">
            <span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">2</span>
            <p>Open the browser console with <kbd class="bg-gray-700 px-2 py-1 rounded">F12</kbd> and switch to the <strong>Console</strong> tab</p>
          </div>
          <div class="flex items-start gap-3">
            <span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">3</span>
            <p>Click the <strong>Copy</strong> button</p>
          </div>
          <div class="flex items-start gap-3">
            <span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">4</span>
            <p>Paste the copied script into the console and press <kbd class="bg-gray-700 px-2 py-1 rounded">Enter</kbd></p>
          </div>
        </div>
        
        <div class="mt-6 bg-yellow-900/30 border border-yellow-500/30 rounded-lg p-4">
          <div class="flex items-start gap-3">
            <span class="material-icons text-yellow-400 mt-1">warning</span>
            <div>
              <h4 class="font-semibold text-yellow-300 mb-2">⚠️ Important Notes</h4>
              <ul class="text-sm text-gray-300 space-y-1">
                <li>• Clear browser cache if you encounter errors (Ctrl+F5)</li>
                <li>• only use it für transactions in GoMining</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <footer class="bg-gray-800 p-4 text-center text-gray-400">© 2025 HashFarm</footer>

  <script>
    // Language toggle
    const deBtn = document.getElementById('deBtn');
    const enBtn = document.getElementById('enBtn');
    const deSection = document.getElementById('deSection');
    const enSection = document.getElementById('enSection');

    deBtn.addEventListener('click', () => {
      deSection.style.display = '';
      enSection.style.display = 'none';
      deBtn.classList.add('bg-purple-600');
      enBtn.classList.remove('bg-purple-600');
    });

    enBtn.addEventListener('click', () => {
      deSection.style.display = 'none';
      enSection.style.display = '';
      enBtn.classList.add('bg-purple-600');
      deBtn.classList.remove('bg-purple-600');
    });

    // Copy to clipboard
    async function copyToClipboard(elementId, event) {
      const el = document.getElementById(elementId);
      if (!el) return;
      const text = el.value || '';
      try {
        await navigator.clipboard.writeText(text);
        const isDE = elementId.toLowerCase().includes('de');
        const id = isDE ? 'copySuccessDE' : 'copySuccessEN';
        const msg = document.getElementById(id);
        if (msg) {
          msg.classList.remove('hidden');
          setTimeout(() => msg.classList.add('hidden'), 3000);
        }
        // small button feedback
        const btn = event?.currentTarget || event?.target?.closest('button');
        if (btn) {
          const orig = btn.innerHTML;
          btn.innerHTML = '<span class="material-icons">check</span> ' + (isDE ? 'Kopiert' : 'Copied');
          setTimeout(() => btn.innerHTML = orig, 2000);
        }
      } catch (err) {
        console.error('Copy failed', err);
      }
    }

    // Simple sidebar toggle (if present)
    function toggleSidebar() {
      const sb = document.getElementById('sidebar');
      if (!sb) return;
      sb.classList.toggle('open');
    }
  </script>
</body>
</html>