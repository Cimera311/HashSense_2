<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoMining Reinvestment Calculator - HashSense</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="priceMatrix.js"></script>
    <script src="src/scripts/skript.js"></script>
    <script src="src/scripts/reinvest-calculator.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Plausible Analytics -->
    <script defer data-domain="hashfarm.me" src="https://plausible.io/js/script.js"></script>

    <!-- Open Graph Meta -->
    <meta property="og:title" content="GoMining Reinvestment Calculator – HashFarm">
    <meta property="og:description" content="Calculate GoMining reinvestment strategies with 5% bonus and optimize your Bitcoin mining growth.">
    <meta property="og:image" content="https://hashfarm.me/assets/preview.png">
    <meta property="og:url" content="https://hashfarm.me/reinvest-calculator.html">
    <meta property="og:type" content="website">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">

    <!-- Google Material Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    <style>
        /* Range Slider Styling */
        input[type="range"] {
            outline: none !important;
            scroll-margin: 0 !important;
            scroll-padding: 0 !important;
            pointer-events: auto;
        }
        
        input[type="range"]:focus {
            outline: none !important;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        /* Sidebar Styling */
        .sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .sidebar.open {
            transform: translateX(0);
        }

        /* Table Styling */
        .results-table th,
        .results-table td {
            padding: 8px 12px;
            text-align: right;
            border-bottom: 1px solid #374151;
        }
        
        .results-table th {
            background-color: #1f2937;
            font-weight: 600;
            color: #d1d5db;
        }
        
        .results-table tbody tr:hover {
            background-color: #374151;
        }

        /* Strategy Cards */
        .strategy-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .strategy-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .strategy-card.selected {
            border: 2px solid #8b5cf6;
            background-color: #1e1b4b;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

    <!-- Header with Price Cards -->
    <header class="bg-gray-800 p-4">
        <div class="max-w-7xl mx-auto">
            <!-- Header with Burger Button -->
            <div class="flex items-center justify-between mb-4">
                <button onclick="toggleSidebar()" 
                        class="bg-gray-700 hover:bg-gray-600 p-2 rounded-lg transition-colors duration-200">
                    <span class="material-icons text-white">menu</span>
                </button>
                <h1 class="text-xl font-bold text-white">GoMining Reinvestment Calculator</h1>
                <div class="w-10"></div> <!-- Spacer for centering -->
            </div>
            
            <!-- Price Cards Grid -->
            <div class="grid gap-4 md:grid-cols-3 mb-4">
                <!-- BTC Price Card -->
                <div class="bg-gray-700 rounded-xl p-4 shadow-lg">
                    <h2 class="text-sm font-semibold mb-3 text-gray-300">CURRENT BITCOIN PRICE</h2>
                    <div class="flex items-center gap-3">
                        <img src="bitcoin-910307_1280.webp" alt="BTC" class="w-10 h-10">
                        <select id="bitcoin-price-dropdown" onchange="updateBTCPrice();" 
                                class="flex-1 bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="10000">10,000 $</option>
                            <option value="20000">20,000 $</option>
                            <option value="30000">30,000 $</option>    
                            <option value="40000">40,000 $</option>
                            <option value="50000">50,000 $</option>
                            <option value="60000">60,000 $</option>   
                            <option value="70000">70,000 $</option>
                            <option value="80000">80,000 $</option>
                            <option value="90000">90,000 $</option>
                            <option id="currentp" value="0">current price</option>
                            <option value="100000">100,000 $</option>
                            <option value="110000">110,000 $</option>
                            <option value="120000">120,000 $</option>
                            <option value="130000">130,000 $</option>
                            <option value="140000">140,000 $</option>
                            <option value="150000">150,000 $</option>
                            <option value="160000">160,000 $</option>
                            <option value="200000">200,000 $</option>
                            <option value="250000">250,000 $</option>
                            <option value="300000">300,000 $</option>
                            <option value="400000">400,000 $</option>   
                        </select>
                    </div>
                </div>

                <!-- GMT Price Card -->
                <div class="bg-gray-700 rounded-xl p-4 shadow-lg">
                    <h2 class="text-sm font-semibold mb-3 text-gray-300">CURRENT GMT PRICE</h2>
                    <div class="flex items-center gap-3">
                        <img src="GoMining_Logo.webp" alt="GMT" class="w-10 h-10">
                        <input type="number" id="gmt-token-price" placeholder="0.4269" step="0.0001" value="0.4269"
                               class="flex-1 bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                </div>

                <!-- SAT per TH Card -->
                <div class="bg-gray-700 rounded-xl p-4 shadow-lg">
                    <h2 class="text-sm font-semibold mb-3 text-gray-300">SAT PER TH</h2>
                    <div class="flex items-center gap-3">
                        <img src="sats-ordinals-sats-logo.png" alt="⚡" class="w-10 h-10">
                        <input type="number" id="sat-TH" value="42" min="0" step="1"
                               class="flex-1 bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar fixed left-0 top-0 w-64 h-full bg-gray-800 z-40 shadow-xl" id="sidebar">
        <div class="p-4">
            <h2 class="text-xl font-bold mb-6 text-purple-400">HashSense</h2>
            <nav class="space-y-2">
                <!-- Home Button -->
                <a href="index.html" 
                   class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200 text-left">
                    <span class="material-icons">home</span>
                    <span>Home</span>
                </a>

                <!-- Mining Calculator -->
                <a href="HashSense.html" 
                   class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200 text-left">
                    <span class="material-icons">calculate</span>
                    <span>Mining Calculator</span>
                </a>

                <!-- Reinvestment Calculator (Active) -->
                <a href="reinvest-calculator.html" 
                   class="w-full flex items-center gap-3 p-3 rounded-lg transition-colors duration-200 bg-purple-600 text-left">
                    <span class="material-icons">trending_up</span>
                    <span>Reinvestment Calculator</span>
                </a>

                <!-- Support -->
                <a href="support.html" 
                   class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200 text-left">
                    <span class="material-icons">support</span>
                    <span>Support</span>
                </a>
            </nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto p-4 space-y-6">

        <!-- Input Parameters Section -->
        <section class="bg-gray-800 rounded-xl p-6 shadow-lg">
            <h2 class="text-2xl font-bold mb-6 text-purple-400">Starting Parameters</h2>
            
            <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                <!-- GMT Wallet Balance -->
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-300">GMT Wallet Balance</label>
                    <input type="number" id="gmt-wallet-balance" value="0" min="0" step="0.01" 
                           class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>

                <!-- Farm Total TH -->
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-300">Total Farm TH</label>
                    <input type="number" id="farm-total-th" value="10" min="0.1" step="0.1" 
                           class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>

                <!-- Farm Average Efficiency -->
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-300">Farm Avg. Efficiency (W/TH)</label>
                    <input type="number" id="farm-efficiency" value="20.00" min="15" max="50" step="0.01" 
                           class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>

                <!-- Target Miner TH -->
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-300">Target Miner TH</label>
                    <input type="number" id="miner-th" value="1" min="0.1" step="0.1" 
                           class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>

                <!-- Target Miner Efficiency -->
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-300">Target Miner Efficiency (W/TH)</label>
                    <select id="miner-efficiency" 
                            class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <option value="15">15 W/TH</option>
                        <option value="16">16 W/TH</option>
                        <option value="17">17 W/TH</option>
                        <option value="18">18 W/TH</option>
                        <option value="19" selected>19 W/TH</option>
                        <option value="20">20 W/TH</option>
                        <option value="21">21 W/TH</option>
                        <option value="22">22 W/TH</option>
                        <option value="23">23 W/TH</option>
                        <option value="24">24 W/TH</option>
                        <option value="25">25 W/TH</option>
                        <option value="30">30 W/TH</option>
                        <option value="35">35 W/TH</option>
                        <option value="40">40 W/TH</option>
                        <option value="50">50 W/TH</option>
                        <option value="60">60 W/TH</option>
                    </select>
                </div>

                <!-- Calculation Period -->
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-300">Calculation Period (Days)</label>
                    <input type="number" id="calculation-period" value="365" min="30" max="3650" step="1" 
                           class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
            </div>
        </section>

        <!-- Reinvestment Strategy Selection -->
        <section class="bg-gray-800 rounded-xl p-6 shadow-lg">
            <h2 class="text-2xl font-bold mb-6 text-purple-400">Reinvestment Strategy</h2>
            
            <div class="grid gap-4 md:grid-cols-3">
                <!-- Automatic Reinvestment -->
                <div class="strategy-card bg-gray-700 rounded-lg p-4 border-2 border-transparent" 
                     onclick="selectStrategy('auto')">
                    <div class="flex items-center gap-3 mb-3">
                        <span class="material-icons text-green-400">autorenew</span>
                        <h3 class="font-bold">Automatic Reinvest</h3>
                    </div>
                    <p class="text-sm text-gray-300 mb-3">100% daily profits reinvested with 5% bonus</p>
                    <div class="text-green-400 font-bold">+5% Bonus</div>
                </div>

                <!-- Manual Reinvestment -->
                <div class="strategy-card bg-gray-700 rounded-lg p-4 border-2 border-transparent" 
                     onclick="selectStrategy('manual')">
                    <div class="flex items-center gap-3 mb-3">
                        <span class="material-icons text-blue-400">build</span>
                        <h3 class="font-bold">Manual Reinvest</h3>
                    </div>
                    <p class="text-sm text-gray-300 mb-3">Manual reinvestment of profits (no bonus)</p>
                    <div class="text-blue-400 font-bold">No Bonus</div>
                </div>

                <!-- Controlled Auto Reinvestment -->
                <div class="strategy-card bg-gray-700 rounded-lg p-4 border-2 border-transparent selected" 
                     onclick="selectStrategy('controlled')">
                    <div class="flex items-center gap-3 mb-3">
                        <span class="material-icons text-purple-400">tune</span>
                        <h3 class="font-bold">Controlled Auto</h3>
                    </div>
                    <p class="text-sm text-gray-300 mb-3">Mix of auto reinvest and saving for electricity</p>
                    <div class="text-purple-400 font-bold">Customizable</div>
                </div>
            </div>

            <!-- Controlled Strategy Settings -->
            <div id="controlled-settings" class="mt-6 p-4 bg-gray-700 rounded-lg">
                <h4 class="font-bold mb-4 text-purple-400">Controlled Auto Settings</h4>
                <div class="grid gap-4 md:grid-cols-2">
                    <!-- Auto Reinvest Days -->
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-gray-300">Auto Reinvest Days (with 5% bonus)</label>
                        <input type="range" id="auto-days" min="0" max="30" value="20" step="1"
                               class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-sm text-gray-400">
                            <span>0</span>
                            <span id="auto-days-value" class="font-bold text-purple-400">20 days</span>
                            <span>30</span>
                        </div>
                    </div>

                    <!-- Saving Days -->
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-gray-300">Saving Days (accumulate GMT for electricity)</label>
                        <div class="text-sm text-gray-400 mt-2">
                            Saving Days: <span id="saving-days-value" class="font-bold text-blue-400">10 days</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Calculate Button -->
        <section class="text-center">
            <button onclick="calculateReinvestment()" 
                    class="bg-purple-600 hover:bg-purple-700 px-8 py-3 rounded-lg font-bold text-lg transition-colors duration-200">
                Calculate Reinvestment Strategy
            </button>
        </section>

        <!-- Results Section -->
        <section id="results-section" class="bg-gray-800 rounded-xl p-6 shadow-lg hidden">
            <h2 class="text-2xl font-bold mb-6 text-purple-400">Results</h2>
            
            <!-- Growth Chart -->
            <div class="mb-8">
                <h3 class="text-lg font-bold mb-4 text-gray-300">Growth Over Time</h3>
                <div class="chart-container bg-gray-700 rounded-lg p-4">
                    <canvas id="growthChart"></canvas>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="grid gap-4 md:grid-cols-3 mb-8">
                <div class="bg-gray-700 rounded-lg p-4">
                    <h4 class="text-sm font-medium text-gray-300 mb-2">Final TH Amount</h4>
                    <div id="final-th" class="text-2xl font-bold text-green-400">-</div>
                </div>
                <div class="bg-gray-700 rounded-lg p-4">
                    <h4 class="text-sm font-medium text-gray-300 mb-2">Total Investment</h4>
                    <div id="total-investment" class="text-2xl font-bold text-blue-400">-</div>
                </div>
                <div class="bg-gray-700 rounded-lg p-4">
                    <h4 class="text-sm font-medium text-gray-300 mb-2">Final GMT Balance</h4>
                    <div id="final-gmt-balance" class="text-2xl font-bold text-purple-400">-</div>
                </div>
            </div>

            <!-- Detailed Results Table -->
            <div class="overflow-x-auto">
                <h3 class="text-lg font-bold mb-4 text-gray-300">Detailed Timeline</h3>
                <table class="results-table w-full bg-gray-700 rounded-lg overflow-hidden">
                    <thead>
                        <tr>
                            <th>Period</th>
                            <th>Date</th>
                            <th>TH Amount</th>
                            <th>Daily Profit (USD)</th>
                            <th>Reinvestment (USD)</th>
                            <th>GMT Balance</th>
                            <th>Strategy</th>
                        </tr>
                    </thead>
                    <tbody id="results-table-body">
                        <!-- Results will be inserted here -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Overlay for Sidebar -->
    <div class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden" id="sidebar-overlay" onclick="closeSidebar()"></div>

    <script>
        // Global variables for calculation
        let currentStrategy = 'controlled';
        let growthChart = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            setupEventListeners();
        });

        function initializePage() {
            // Load current BTC price
            loadCurrentBTCPrice();
            
            // Update controlled settings display
            updateControlledSettings();
        }

        function setupEventListeners() {
            // Auto days slider
            document.getElementById('auto-days').addEventListener('input', updateControlledSettings);
            
            // All inputs for real-time calculation
            const inputs = ['gmt-wallet-balance', 'farm-total-th', 'farm-efficiency', 'miner-th', 'miner-efficiency', 'calculation-period'];
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', debounce(calculateReinvestment, 500));
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function updateControlledSettings() {
            const autoDays = parseInt(document.getElementById('auto-days').value);
            const savingDays = 30 - autoDays;
            
            document.getElementById('auto-days-value').textContent = `${autoDays} days`;
            document.getElementById('saving-days-value').textContent = `${savingDays} days`;
        }

        function selectStrategy(strategy) {
            currentStrategy = strategy;
            
            // Update visual selection
            document.querySelectorAll('.strategy-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.strategy-card').classList.add('selected');
            
            // Show/hide controlled settings
            const controlledSettings = document.getElementById('controlled-settings');
            if (strategy === 'controlled') {
                controlledSettings.style.display = 'block';
            } else {
                controlledSettings.style.display = 'none';
            }
            
            // Recalculate if results are visible
            if (!document.getElementById('results-section').classList.contains('hidden')) {
                calculateReinvestment();
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('hidden');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.remove('open');
            overlay.classList.add('hidden');
        }

        function updateBTCPrice() {
            const btcPrice = document.getElementById('bitcoin-price-dropdown').value;
            // This function would be connected to price update logic
            console.log('BTC Price updated to:', btcPrice);
        }

        async function loadCurrentBTCPrice() {
            try {
                // Use the existing price fetch functions from skript.js
                fetchBTCPrice();
                fetchGMTPrice();
            } catch (error) {
                console.log('Could not load current prices:', error);
                // Set defaults if price fetch fails
                document.getElementById('bitcoin-price-dropdown').value = '67000';
                document.getElementById('gmt-token-price').value = '0.4269';
            }
        }

        // Main calculation is handled in reinvest-calculator.js
    </script>
</body>
</html>